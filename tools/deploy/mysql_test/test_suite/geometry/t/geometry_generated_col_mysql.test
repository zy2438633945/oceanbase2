#owner: ht353245
#owner group: shenzhen
--echo # ----------------------------------------------------------------------
--echo # Base test of GEOMETRY spatial index.
--echo # ----------------------------------------------------------------------
--source mysql_test/test_suite/geometry/t/import_default_srs_data_mysql.inc

--disable_warnings
drop table if exists t1;
--enable_warnings

CREATE TABLE t1 (x INTEGER,
                 y INTEGER,
                 g POINT GENERATED ALWAYS AS (POINT(x, y)) NOT NULL SRID 0);
SHOW COLUMNS FROM t1;
INSERT INTO t1(x,y) VALUES (0, 0);
INSERT INTO t1(x,y) VALUES (0.1, 0.1);
SELECT x,y,st_astext(g) FROM t1 ORDER BY x;
DROP TABLE t1;

CREATE TABLE t1 (x INTEGER,
                 y INTEGER,
                 g POINT GENERATED ALWAYS AS (POINT(x, y)) NOT NULL SRID 4326);
SHOW COLUMNS FROM t1;
--error 3643
INSERT INTO t1(x,y) VALUES (0, 0);
--error 3643
INSERT INTO t1(x,y) VALUES (0.1, 0.1);
SELECT x,y,st_astext(g) FROM t1 ORDER BY x;
DROP TABLE t1;

CREATE TABLE t1 (x INTEGER,
                 y INTEGER,
                 g POINT GENERATED ALWAYS AS (ST_GEOMFROMTEXT('POINT(1 1)', 4326)) STORED NOT NULL SRID 4326);
SHOW COLUMNS FROM t1;
INSERT INTO t1(x,y) VALUES (0, 0);
INSERT INTO t1(x,y) VALUES (0.1, 0.1);
DROP TABLE t1;

CREATE TABLE t1 (x INTEGER,
                 y INTEGER,
                 g POINT GENERATED ALWAYS AS (ST_GEOMFROMTEXT('POINT(1 1)', 0)) STORED NOT NULL SRID 4326);
SHOW COLUMNS FROM t1;
--error 3643
INSERT INTO t1(x,y) VALUES (0, 0);
--error 3643
INSERT INTO t1(x,y) VALUES (0.1, 0.1);
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(ST_GEOMFROMTEXT('POINT(0 0)', 4326), g)));
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((0 0,10 0,10 10,0 10,0 0)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(ST_GEOMFROMTEXT('POINT(0 0)', 4326), g)));
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((1 1,10 0,10 10,0 10,1 1)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(g, ST_GEOMFROMTEXT('POINT(0 0)', 4326))));
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((0 0,10 0,10 10,0 10,0 0)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(g, ST_GEOMFROMTEXT('POINT(0 0)', 4326))));
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((1 1,10 0,10 10,0 10,1 1)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(ST_GEOMFROMTEXT('POINT(0 0)', 4326), g)) STORED);
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((0 0,10 0,10 10,0 10,0 0)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(ST_GEOMFROMTEXT('POINT(0 0)', 4326), g)) STORED);
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((1 1,10 0,10 10,0 10,1 1)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(g, ST_GEOMFROMTEXT('POINT(0 0)', 4326))) STORED);
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((0 0,10 0,10 10,0 10,0 0)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

CREATE TABLE t1 (g GEOMETRY NOT NULL SRID 4326,
                 i INT GENERATED ALWAYS AS (ST_INTERSECTS(g, ST_GEOMFROMTEXT('POINT(0 0)', 4326))) STORED);
SHOW COLUMNS FROM t1;
INSERT INTO t1(g) VALUES (ST_GEOMFROMTEXT('MULTIPOLYGON(((1 1,10 0,10 10,0 10,1 1)))', 4326));
SELECT i,st_astext(g) FROM t1 ORDER BY i;
DROP TABLE t1;

# bugfix: 
CREATE TABLE t1(id INT, p POLYGON GENERATED ALWAYS AS (ST_GeomFromText('POINT(15 20)',0)) STORED);
--error 1416
INSERT INTO t1(id) VALUES (1);
DROP TABLE t1;
