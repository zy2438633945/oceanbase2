#owner: ht353245
#owner group: shenzhen
--echo # ----------------------------------------------------------------------
--echo # Test of GEOMETRY ST_SRID
--echo # ----------------------------------------------------------------------
--source mysql_test/test_suite/geometry/t/import_default_srs_data_mysql.inc

--echo # Must return 0.
SELECT ST_SRID(CAST(ST_GEOMFROMTEXT('POINT(1 1)', 0) AS POINT));
--echo #

--echo # Must return 4326.
SELECT ST_SRID(CAST(ST_GEOMFROMTEXT('POINT(45 90)', 4326) AS POINT));
--echo #

--echo # 
SET @g = ST_GeomFromText('LineString(1 1,2 2)', 0);
SELECT ST_SRID(@g);
SELECT ST_ASTEXT(ST_SRID(@g, 4326));
--echo #

--echo #
SET @g = ST_GeomFromText('MULTIPOINT(1 1, 11 11, 11 21, 21 21)', 2343);
SELECT ST_SRID(@g);
SELECT ST_ASTEXT(ST_SRID(@g, 3234));
--echo #

--echo #
SET @g = ST_GeomFromText('Polygon((0 0, 0 8, 8 8, 8 10, -10 10, -10 0, 0 0))', 4326);
SELECT ST_SRID(@g);
SELECT ST_ASTEXT(ST_SRID(@g, 2343));
--echo #

--echo #
SET @g = ST_GeomFromText('GEOMETRYCOLLECTION(POLYGON((0 0,50 45,40 50,0 0)),LINESTRING(-10 -10,0 0),LINESTRING(46.666666666666664 46.666666666666664,200 200,199 201,45.333333333333336 47.333333333333336),LINESTRING(8 10,-11 -9))', 2343);
SELECT ST_SRID(@g);
SELECT ST_ASTEXT(ST_SRID(@g, 2343));
--echo #

--echo #
SET @g = ST_GeomFromText('GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(),GEOMETRYCOLLECTION EMPTY, GEOMETRYCOLLECTION(POINT(1 1)), MULTILINESTRING((10 48,10 21,10 0),(16 0,16 23,16 48)), MULTIPOLYGON(((28 26,28 0,84 0,84 42,28 26),(52 18,66 23,73 9,48 6,52 18)),((59 18,67 18,67 13,59 13,59 18))), MULTIPOINT((0 0),(10 10),(10 20),(20 20)), MULTIPOINT(1 1, 11 11, 11 21, 21 21), GEOMETRYCOLLECTION(LINESTRING(1 1,2 2)), GEOMETRYCOLLECTION(POLYGON((0 0,50 45,40 50,0 0)),LINESTRING(-10 -10,0 0),LINESTRING(46.666666666666664 46.666666666666664,200 200,199 201,45.333333333333336 47.333333333333336),LINESTRING(8 10,-11 -9)))', 2343);
SELECT ST_SRID(@g);
SELECT ST_ASTEXT(ST_SRID(@g, 0));
--echo #

--echo # Test for String (creates the geometry in SRID 0, then casts it to SRID 4326)
SELECT ST_ASTEXT(ST_SRID(Point(1, 1), 4326));
SELECT ST_ASTEXT(ST_SRID(POINT(25.416666666666668, 25.416666666666668), 4326));
--error 1690
SELECT ST_SRID(Point(1, 1), -1);
--error 1690
SELECT ST_SRID(Point(1, 1), 1e30);
# SELECT ST_SRID(POLYGON(LINESTRING(POINT(0,0), POINT(0,10), POINT(10,10), POINT(10,0), POINT(0,0)), LINESTRING(POINT(4,4), POINT(4,6), POINT(6,6), POINT(6,4), POINT(4,4))), 4326);
# SELECT ST_SRID(GEOMETRYCOLLECTION(MULTILINESTRING(LINESTRING(POINT(0,0),POINT(1,0)),LINESTRING(POINT(0,0),POINT(1,0)))), 4326);
--echo #

--echo # Test for ->srid 0
select ST_ASTEXT(st_srid(st_geomfromtext('point(90 90)', 4326), 0));
select ST_ASTEXT(st_srid(st_geomfromtext('point(90 90)', 4396), 0));
--echo # Test for invalid input data
--error 3732
select st_srid(st_geomfromtext('point(100 100)'), 4326);
--echo #

--echo # Test for setsrid
select ST_ASTEXT(_st_setsrid(point(90,90), 4326));
--error 3732
set @g = _st_setsrid(point(100,100), 4326);
--error 3732
select _st_setsrid(point(100,100), 4326);
--echo # Test for invalid srid
select ST_ASTEXT(st_srid(point(90,90), ''));
select ST_ASTEXT(st_srid(point(90,90), 'invalid'));
--echo #

--echo # Test for srid!=0 && srs_item == null
select st_srid(x'02000000010100000000000000000000000000000000000000');
--echo #

--echo # Test unusual input (different from st_x/st_buffer..)
--error 3037
select st_srid(1.1);
--error 3037
select st_srid(10.2);
--error 3037
select st_srid(102342);
--error 3037
select st_srid('sdfwefqwe');
--error 3037
select st_isvalid(x'e610000001040000000000000000002EC000000000000034C0');

# bugfix : 
select st_srid(x'0000000001030000000200000005000000000000000000000000000000000000000000000000002440000000000000000000000000000024400000000000002440000000000000000000000000000024400000000000000000000000000000000005000000000000000000144000000000000014400000000000001C4000000000000014400000000000001C400000000000001C4000000000000014400000000000001C4000000000000014400000000000001441');

# bugfix: 
--error 3037
SELECT _ST_SETSRID(NULL,4326);
--error 3037
SELECT _ST_SETSRID('NULL',4326);
--error 3037
SELECT _ST_SETSRID(x'02000000010100000000000000000000000000000000000000',NULL);
SELECT ST_ASTEXT(_ST_SETSRID(ST_GEOMFROMTEXT('POINT(1 2)'),NULL));
--error 1292
SELECT _ST_SETSRID(ST_GEOMFROMTEXT('POINT(1 2)'),'NULL');
SELECT ST_ASTEXT(_ST_SETSRID(ST_GEOMFROMTEXT('POINT(1 2)'),4326));
SELECT ST_ASTEXT(_ST_SETSRID(ST_GEOMFROMTEXT('POINT(1 2)'),'4326'));
--error 1292
SELECT ST_ASTEXT(_ST_SETSRID(ST_GEOMFROMTEXT('POINT(1 2)'),'4326abc'));
--error 1292
SELECT ST_ASTEXT(_ST_SETSRID(ST_GEOMFROMTEXT('POINT(1 2)'),'true'));
--error 5083
SELECT ST_ASTEXT(_ST_SETSRID(ST_GEOMFROMTEXT('POINT(1 2)'),true));

# bugfix : 
--error 3037
SELECT _ST_SETSRID(ST_GEOMFROMTEXT('POINT'),NULL);

# bugfix : 
select st_astext(st_srid(x'0000000001030000000300000005000000000010000000000000000000000000000000000000002440000000000000000000000000000024400000000000002440000000000000000000000000000024400000000000000000000000000000000005000000000000000000144000000000000014400000000000001C4000000000000014400000000000001C400000000000001C4000000000000014400000000000001C40000000000000144000000000000014410500000000000000000014C000000000000014C00000000000001CC000000000000014C00000000000001CC00000000000001CC000000000000014C00000000000001CC000000000000014C000000000000014C0',0));

--echo bugfix: 53257405
select st_srid(st_geomfromtext('point(100 100)')) - 3;

select weight_string(st_srid(NULL));
--error 3037
select weight_string(st_srid(3333));